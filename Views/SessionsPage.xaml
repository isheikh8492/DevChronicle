<Page x:Class="DevChronicle.Views.SessionsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
      Title="Sessions"
      Foreground="{DynamicResource TextFillColorPrimaryBrush}">

    <ScrollViewer>
        <StackPanel Margin="56,24,56,24">
            <TextBlock
                FontSize="28"
                FontWeight="SemiBold"
                Text="Sessions"
                Margin="0,0,0,8"/>
            <TextBlock
                FontSize="14"
                Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                Text="View and manage your Git mining sessions."
                Margin="0,0,0,24"/>

            <StackPanel Orientation="Horizontal" Margin="0,0,0,24">
                <ui:Button
                    Content="Create Session"
                    Icon="{ui:SymbolIcon Add24}"
                    Appearance="Primary"
                    Command="{Binding CreateSessionCommand}"
                    Margin="0,0,12,0"/>
                <ui:Button
                    Content="Reload"
                    Icon="{ui:SymbolIcon ArrowSync24}"
                    Command="{Binding LoadSessionsCommand}"
                    Margin="0,0,12,0"/>
            </StackPanel>

            <!-- Sessions List -->
            <ItemsControl ItemsSource="{Binding Sessions}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <ui:Card Margin="0,0,0,12">
                            <Border Padding="16">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0">
                                        <TextBlock FontSize="16" FontWeight="Medium" Text="{Binding Name}" Margin="0,0,0,4"/>
                                        <TextBlock FontSize="12" Foreground="{DynamicResource TextFillColorSecondaryBrush}">
                                            <Run Text="Repository: "/>
                                            <Run Text="{Binding RepoPath}"/>
                                        </TextBlock>
                                        <TextBlock FontSize="12" Foreground="{DynamicResource TextFillColorSecondaryBrush}">
                                            <Run Text="Created: "/>
                                            <Run Text="{Binding CreatedAt, StringFormat='yyyy-MM-dd HH:mm'}"/>
                                        </TextBlock>
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                                        <ui:Button
                                            Content="Open"
                                            Icon="{ui:SymbolIcon Open24}"
                                            Appearance="Primary"
                                            Command="{Binding DataContext.OpenSessionCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                            CommandParameter="{Binding}"
                                            Margin="0,0,8,0"/>
                                        <ui:Button
                                            Icon="{ui:SymbolIcon Delete24}"
                                            Appearance="Danger"
                                            Command="{Binding DataContext.DeleteSessionCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                            CommandParameter="{Binding}"/>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </ui:Card>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>

            <!-- No sessions message -->
            <ui:Card Visibility="{Binding Sessions.Count, Converter={StaticResource CountToVisibilityConverter}}">
                <Border Padding="16">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <ui:SymbolIcon Grid.Column="0" Symbol="Info24" Margin="0,0,16,0" FontSize="24" Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock FontSize="14" Text="No sessions found" Margin="0,0,0,4"/>
                            <TextBlock
                                FontSize="12"
                                Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                Text="Create a new session to start mining your Git history."/>
                        </StackPanel>
                    </Grid>
                </Border>
            </ui:Card>
        </StackPanel>
    </ScrollViewer>
</Page>
